"use strict";(self["webpackChunkims"]=self["webpackChunkims"]||[]).push([[5226],{5226:(e,t,l)=>{l.r(t),l.d(t,{default:()=>L});l(246);var a=l(3673),o=l(2323),s=l(8880);const n={class:"q-pa-xl"},i={class:"q-pa-md"},d={class:"row justify-center"},r={class:"q-pl-sm"},u={class:"row justify-center q-gutter-md q-pa-md"},p={class:"row q-gutter-md"},m={class:"col q-pt-md q-gutter-md"},c=(0,a._)("span",{class:"q-pl-xl"},[(0,a._)("b",null," Add Credit Settlement")],-1),w={class:"row q-gutter-md"},h={class:"column"},y={class:"row q-pa-lg q-gutter-lg"},f={class:"row items-center justify-end"},v={class:"row q-pa-lg q-gutter-lg"},_={class:"row justify-center q-pl-xl"},g={class:"col-2 q-table__title"},b={key:0,class:"col"},D={class:"q-pa-md",style:{"max-width":"300px"}},V={class:"row items-center justify-end"};function R(e,t,l,R,q,U){const C=(0,a.up)("CreditSettlementHeader"),F=(0,a.up)("q-item"),x=(0,a.up)("DeleteDialogBox"),E=(0,a.up)("q-btn"),W=(0,a.up)("q-date"),k=(0,a.up)("q-popup-proxy"),S=(0,a.up)("q-icon"),P=(0,a.up)("q-input"),Z=(0,a.up)("q-form"),j=(0,a.up)("q-tooltip"),Q=(0,a.up)("q-linear-progress"),O=(0,a.up)("q-space"),$=(0,a.up)("q-toggle"),T=(0,a.up)("q-select"),Y=(0,a.up)("q-popup-edit"),N=(0,a.up)("q-td"),z=(0,a.up)("q-tr"),H=(0,a.up)("q-table"),I=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",n,[(0,a.Wm)(C)]),(0,a._)("div",i,[(0,a._)("div",d,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(q.REF,((e,t)=>((0,a.wg)(),(0,a.j4)(F,{key:t},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t)+": ",1),(0,a._)("span",r,[(0,a._)("b",null,(0,o.zw)(e),1)])])),_:2},1024)))),128))]),(0,a.Wm)(x,{onResponse:U.getResponse,ref:"confirmbox"},null,8,["onResponse"]),(0,a._)("div",u,[(0,a._)("div",p,[(0,a._)("div",m,[c,(0,a.Wm)(Z,{onSubmit:U.Add_REF_CS,onReset:U.reset,class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a._)("div",w,[(0,a._)("div",h,[(0,a._)("div",y,[(0,a.Wm)(P,{color:"secondary",label:"Date",filled:"",modelValue:q.date,"onUpdate:modelValue":t[1]||(t[1]=e=>q.date=e)},{prepend:(0,a.w5)((()=>[(0,a.Wm)(S,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{color:"secondary",modelValue:q.date,"onUpdate:modelValue":t[0]||(t[0]=e=>q.date=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a.wy)((0,a.Wm)(E,{label:"Close",color:"secondary",flat:""},null,512),[[I]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(P,{color:"secondary",modelValue:q.payment,"onUpdate:modelValue":t[2]||(t[2]=e=>q.payment=e),type:"number",min:"1",filled:"",label:"payment",rules:[U.myRule]},null,8,["modelValue","rules"]),(0,a.Wm)(P,{color:"secondary",modelValue:q.description,"onUpdate:modelValue":t[3]||(t[3]=e=>q.description=e),type:"text",min:"1",filled:"",label:"Description"},null,8,["modelValue"])]),(0,a._)("div",v,[(0,a.Wm)(E,{disable:this.REF.Paid>=this.REF.Total,label:"Add",type:"submit",color:"secondary"},null,8,["disable"]),(0,a.Wm)(E,{label:"Reset",type:"reset",color:"secondary",flat:"",class:"q-ml-sm"})])])])])),_:1},8,["onSubmit","onReset"])])])]),(0,a._)("div",_,[(0,a.Wm)(H,{title:q.title,rows:q.rows,columns:q.columns,"row-key":"name","visible-columns":q.visibleColumns,loading:q.loading,color:"secondary","no-data-label":"There is No Credit Settlement Under this REF","rows-per-page-options":[0]},{top:(0,a.w5)((l=>[(0,a.Wm)(Q,{color:"secondary",value:U.getPercentage,class:"q-mt-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(j,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(100*U.getPercentage)+" % Have Been Paid ",1)])),_:1})])),_:1},8,["value"]),(0,a._)("div",g,(0,o.zw)(q.title),1),(0,a.Wm)(O),e.$q.screen.gt.xs?((0,a.wg)(),(0,a.iD)("div",b,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.toogle_columns,(e=>((0,a.wg)(),(0,a.j4)(F,{style:{display:"inline"},key:e},{default:(0,a.w5)((()=>[(0,a.Wm)($,{modelValue:q.visibleColumns,"onUpdate:modelValue":t[4]||(t[4]=e=>q.visibleColumns=e),val:e.name,label:e.label,color:"secondary"},null,8,["modelValue","val","label"])])),_:2},1024)))),128))])):((0,a.wg)(),(0,a.j4)(T,{key:1,color:"secondary",modelValue:q.visibleColumns,"onUpdate:modelValue":t[5]||(t[5]=e=>q.visibleColumns=e),multiple:"",borderless:"",dense:"","options-dense":"","display-value":e.$q.lang.table.columns,"emit-value":"","map-options":"",options:q.columns,"option-value":"name",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])),(0,a.Wm)(E,{color:"secondary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:U.exportTable},null,8,["onClick"]),(0,a.Wm)(E,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:l.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])])),body:(0,a.w5)((e=>[(0,a.Wm)(z,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(N,{key:"Payment",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Payment)+" Birr ",1),(0,a.Wm)(Y,{modelValue:e.row.Payment,"onUpdate:modelValue":t=>e.row.Payment=t,title:"Update Payment",buttons:"",persistent:"",validate:t=>U.Update_REF_CS({key:"Payment",value:t},q.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,a.w5)((e=>[(0,a.Wm)(P,{color:"secondary",type:"number",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,modelModifiers:{number:!0},dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(N,{key:"Date",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Date)+" ",1),(0,a.Wm)(Y,{modelValue:e.row.Date,"onUpdate:modelValue":t=>e.row.Date=t,title:"Update Date",buttons:"",persistent:"",validate:t=>U.Update_REF_CS({key:"Date",value:t},q.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,a.w5)((e=>[(0,a._)("div",D,[(0,a.Wm)(P,{color:"secondary",filled:"",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t},{prepend:(0,a.w5)((()=>[(0,a.Wm)(S,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{color:"secondary",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",V,[(0,a.wy)((0,a.Wm)(E,{label:"Close",color:"secondary",flat:""},null,512),[[I]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue"])])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(N,{key:"Description",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Description)+" ",1),(0,a.Wm)(Y,{modelValue:e.row.Description,"onUpdate:modelValue":t=>e.row.Description=t,title:"Update Description",buttons:"",persistent:"",validate:t=>U.Update_REF_CS({key:"Description",value:t},q.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,a.w5)((e=>[(0,a.Wm)(P,{color:"secondary",type:"text",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(N,{key:"Quantity",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Quantity),1)])),_:2},1032,["props"]),(0,a.Wm)(N,{key:"action",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{color:"negative","icon-right":"delete","no-caps":"",flat:"",dense:"",onClick:t=>U.show_dialog_box(q.rows.indexOf(e.row))},null,8,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["title","rows","columns","visible-columns","loading"])])])],64)}var q=l(2841),U=l(6966),C=l(9826),F=l(8194),x=l(7428);const E={name:"REFCreditDetail",components:{DeleteDialogBox:U.Z,CreditSettlementHeader:C.Z},data(){return{date:null,payment:null,description:null,loading:!1,title:"Credit Settlement",visibleColumns:["Description"],columns:[{name:"Payment",label:"Payment",field:"Payment",align:"left",required:!0},{name:"Date",label:"Date",field:"Date",required:!0},{name:"Description",label:"Description",field:"Description"},{name:"action",label:"Action",field:"action",required:!0}],rows:[],selected_index:null,categories:[],REF:{}}},computed:{toogle_columns(){return this.columns.filter((e=>!0!==e.required))},getPercentage(){return(this.REF.Paid/this.REF.Total).toFixed(2)}},methods:{myRule(e){if(null===e)return"Empty Feild!!"},validate_REF(){(0,F.H5)(this.$route.params.REFNO).then((e=>{this.REF=e.data,this.fetchRows()})).catch((e=>{this.$router.push({name:"ref-credit-settlement"})}))},fetchRows(){(0,F.$k)(this.$route.params.REFNO).then((e=>{this.rows=e.data,this.loading=!1})).catch((e=>{this.loading=!1}))},getResponse(e){if(e){const e={CSID:this.rows[this.selected_index].CSID,REFNO:this.REF.REFNO};(0,F.$2)(e).then((e=>{(0,x.U)(e.data.message,"positive","top"),this.rows.splice(this.selected_index,1),this.selected_index=null,this.$refs.confirmbox.response=!1,this.validate_REF()})).catch((e=>{(0,x.j)(e.response.data.message,"negative","top")}))}},Add_REF_CS(){if(null===this.date)(0,x.j)("Date is not Selected!!");else if(Date.parse(this.date)<Date.parse(this.REF.SalesDate))(0,x.j)("Date Can't be before the Sales Date");else{const e={REFNO:this.REF.REFNO,Payment:this.payment,Date:this.date,Description:this.description};(0,F.$X)(e).then((e=>{(0,x.U)(e.data.message,"positive","top"),this.rows=[],this.validate_REF()})).catch((e=>{(0,x.j)(e.response.data.message,"negative","top")}))}},reset(){this.date=null,this.description=null,this.payment=null},Update_REF_CS(e,t){var l=this.rows[t],a=e;l[a.key]=a.value;const o={REFNO:this.REF.REFNO,Payment:l.Payment,CSID:l.CSID,Date:l.Date,Description:l.Description};o.Payment<1?((0,x.j)("Payment cant be less than 1"),this.rows=[],this.fetchRows()):Date.parse(o.Date)<Date.parse(this.REF.SalesDate)?((0,x.j)("Date Can't be before the Sales Date"),this.rows=[],this.fetchRows()):(0,F.DF)(o).then((e=>((0,x.U)(e.data.message,"positive","top"),this.rows=[],this.validate_REF(),!0))).catch((e=>((0,x.j)(e.response.data.message,"negative","top"),this.rows=[],this.fetchRows(),!1)))},show_dialog_box(e){this.$refs.confirmbox.message="The Selected Credit Settlement ",this.$refs.confirmbox.confirm=!0,this.selected_index=e},wrapCsvValue(e,t){let l=void 0!==t?t(e):e;return l=void 0===l||null===l?"":String(l),l=l.split('"').join('""'),`"${l}"`},exportTable(){const e=[this.columns.map((e=>this.wrapCsvValue(e.label)))].concat(this.rows.map((e=>this.columns.map((t=>this.wrapCsvValue("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format))).join(",")))).join("\r\n"),t=(0,q.Z)("table-export.csv",e,"text/csv");!0!==t&&(0,x.j)("Browser denied file download...")}},mounted(){this.validate_REF()}};var W=l(3414),k=l(5269),S=l(4842),P=l(4554),Z=l(3944),j=l(2651),Q=l(2165),O=l(3243),$=l(1598),T=l(8870),Y=l(2025),N=l(8886),z=l(8516),H=l(8186),I=l(3884),B=l(1289),K=l(677),A=l(7518),M=l.n(A);E.render=R;const L=E;M()(E,"components",{QItem:W.Z,QForm:k.Z,QInput:S.Z,QIcon:P.Z,QPopupProxy:Z.Z,QDate:j.Z,QBtn:Q.Z,QTable:O.Z,QLinearProgress:$.Z,QTooltip:T.Z,QSpace:Y.Z,QToggle:N.Z,QSelect:z.Z,QTr:H.Z,QTd:I.Z,QPopupEdit:B.Z}),M()(E,"directives",{ClosePopup:K.Z})}}]);