"use strict";(self["webpackChunkims"]=self["webpackChunkims"]||[]).push([[7718],{7718:(e,t,l)=>{l.r(t),l.d(t,{default:()=>H});l(246);var a=l(3673),o=l(2323),s=l(8880);const n={class:"q-pa-xl"},i={class:"q-pa-md"},d={class:"flex flex-center q-gutter-md q-pa-md"},r={class:"q-pl-sm"},u={class:"row q-gutter-md"},p={class:"col q-pt-md q-gutter-md"},c=(0,a._)("span",{class:"q-pl-xl"},[(0,a._)("b",null," Add Credit Settlement")],-1),m={class:"row q-gutter-md"},w={class:"column"},h={class:"row q-pa-lg q-gutter-lg"},y={class:"row items-center justify-end"},f={class:"row q-pa-lg q-gutter-lg"},v={class:"row justify-center q-pl-xl"},g={class:"col-2 q-table__title"},_={key:0,class:"col"};function b(e,t,l,b,D,R){const V=(0,a.up)("CreditSettlementHeader"),q=(0,a.up)("DeleteDialogBox"),N=(0,a.up)("q-item"),x=(0,a.up)("q-btn"),C=(0,a.up)("q-date"),U=(0,a.up)("q-popup-proxy"),G=(0,a.up)("q-icon"),k=(0,a.up)("q-input"),W=(0,a.up)("q-form"),P=(0,a.up)("q-tooltip"),S=(0,a.up)("q-linear-progress"),Z=(0,a.up)("q-space"),Q=(0,a.up)("q-toggle"),j=(0,a.up)("q-select"),O=(0,a.up)("q-popup-edit"),T=(0,a.up)("q-td"),$=(0,a.up)("q-tr"),z=(0,a.up)("q-table"),K=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",n,[(0,a.Wm)(V)]),(0,a._)("div",i,[(0,a.Wm)(q,{onResponse:R.getResponse,ref:"confirmbox"},null,8,["onResponse"]),(0,a._)("div",d,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(D.GRN,((e,t)=>((0,a.wg)(),(0,a.j4)(N,{key:t},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t)+": ",1),(0,a._)("span",r,[(0,a._)("b",null,(0,o.zw)(e),1)])])),_:2},1024)))),128)),(0,a._)("div",u,[(0,a._)("div",p,[c,(0,a.Wm)(W,{onSubmit:R.Add_GRN_CS,onReset:R.reset,class:"q-gutter-md"},{default:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a._)("div",w,[(0,a._)("div",h,[(0,a.Wm)(k,{color:"secondary",label:"Date",filled:"",modelValue:D.date,"onUpdate:modelValue":t[1]||(t[1]=e=>D.date=e)},{prepend:(0,a.w5)((()=>[(0,a.Wm)(G,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(U,{"transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{color:"secondary",modelValue:D.date,"onUpdate:modelValue":t[0]||(t[0]=e=>D.date=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",y,[(0,a.wy)((0,a.Wm)(x,{label:"Close",color:"secondary",flat:""},null,512),[[K]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(k,{color:"secondary",modelValue:D.payment,"onUpdate:modelValue":t[2]||(t[2]=e=>D.payment=e),type:"number",min:"1",filled:"",label:"payment",rules:[R.myRule]},null,8,["modelValue","rules"]),(0,a.Wm)(k,{color:"secondary",modelValue:D.description,"onUpdate:modelValue":t[3]||(t[3]=e=>D.description=e),type:"text",min:"1",filled:"",label:"Description"},null,8,["modelValue"])]),(0,a._)("div",f,[(0,a.Wm)(x,{disable:this.GRN.Paid>=this.GRN.Total,label:"Add",type:"submit",color:"secondary"},null,8,["disable"]),(0,a.Wm)(x,{label:"Reset",type:"reset",color:"secondary",flat:"",class:"q-ml-sm"})])])])])),_:1},8,["onSubmit","onReset"])])])]),(0,a._)("div",v,[(0,a.Wm)(z,{title:D.title,rows:D.rows,columns:D.columns,"row-key":"name","visible-columns":D.visibleColumns,loading:D.loading,color:"secondary","no-data-label":"There is No Credit Settlement Under this GRN","rows-per-page-options":[0]},{top:(0,a.w5)((l=>[(0,a.Wm)(S,{color:"secondary",value:R.getPercentage,class:"q-mt-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(100*R.getPercentage)+" % Have Been Paid ",1)])),_:1})])),_:1},8,["value"]),(0,a._)("div",g,(0,o.zw)(D.title),1),(0,a.Wm)(Z),e.$q.screen.gt.xs?((0,a.wg)(),(0,a.iD)("div",_,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(R.toogle_columns,(e=>((0,a.wg)(),(0,a.j4)(N,{style:{display:"inline"},key:e},{default:(0,a.w5)((()=>[(0,a.Wm)(Q,{modelValue:D.visibleColumns,"onUpdate:modelValue":t[4]||(t[4]=e=>D.visibleColumns=e),val:e.name,label:e.label,color:"secondary"},null,8,["modelValue","val","label"])])),_:2},1024)))),128))])):((0,a.wg)(),(0,a.j4)(j,{key:1,color:"secondary",modelValue:D.visibleColumns,"onUpdate:modelValue":t[5]||(t[5]=e=>D.visibleColumns=e),multiple:"",borderless:"",dense:"","options-dense":"","display-value":e.$q.lang.table.columns,"emit-value":"","map-options":"",options:D.columns,"option-value":"name",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])),(0,a.Wm)(x,{color:"secondary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:R.exportTable},null,8,["onClick"]),(0,a.Wm)(x,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:l.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])])),body:(0,a.w5)((e=>[(0,a.Wm)($,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{key:"Payment",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Payment)+" Birr ",1),(0,a.Wm)(O,{modelValue:e.row.Payment,"onUpdate:modelValue":t=>e.row.Payment=t,title:"Update Payment",buttons:"",persistent:"",validate:t=>R.Update_GRN_CS({key:"Payment",value:t},D.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,a.w5)((e=>[(0,a.Wm)(k,{color:"secondary",type:"number",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,modelModifiers:{number:!0},dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(T,{key:"Date",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Date)+" ",1),(0,a.Wm)(O,{modelValue:e.row.Date,"onUpdate:modelValue":t=>e.row.Date=t,title:"Update Date",buttons:"",persistent:"",validate:t=>R.Update_GRN_CS({key:"Date",value:t},D.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-black"},{default:(0,a.w5)((e=>[(0,a.Wm)(C,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,color:"secondary",minimal:"",dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(T,{key:"Description",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Description)+" ",1),(0,a.Wm)(O,{modelValue:e.row.Description,"onUpdate:modelValue":t=>e.row.Description=t,title:"Update Description",buttons:"",persistent:"",validate:t=>R.Update_GRN_CS({key:"Description",value:t},D.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,a.w5)((e=>[(0,a.Wm)(k,{color:"secondary",type:"text",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,dense:"",autofocus:"",onKeyup:(0,s.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,a.Wm)(T,{key:"Quantity",props:e},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.row.Quantity),1)])),_:2},1032,["props"]),(0,a.Wm)(T,{key:"action",props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{color:"negative","icon-right":"delete","no-caps":"",flat:"",dense:"",onClick:t=>R.show_dialog_box(D.rows.indexOf(e.row))},null,8,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["title","rows","columns","visible-columns","loading"])])])],64)}var D=l(2841),R=l(6966),V=l(9826),q=l(8194),N=l(7428);l(5525);const x={name:"GRNCreditDetail",components:{DeleteDialogBox:R.Z,CreditSettlementHeader:V.Z},data(){return{date:null,payment:null,description:null,loading:!1,title:"Credit Settlement",visibleColumns:["Description"],columns:[{name:"Payment",label:"Payment",field:"Payment",align:"left",required:!0},{name:"Date",label:"Date",field:"Date",required:!0},{name:"Description",label:"Description",field:"Description"},{name:"action",label:"Action",field:"action",required:!0}],rows:[],selected_index:null,categories:[],GRN:{}}},computed:{toogle_columns(){return this.columns.filter((e=>!0!==e.required))},getPercentage(){return(this.GRN.Paid/this.GRN.Total).toFixed(2)}},methods:{myRule(e){if(null===e)return"Empty Feild!!"},validate_GRN(){(0,q.GP)(this.$route.params.GRNNO).then((e=>{this.GRN=e.data,this.fetchRows()})).catch((e=>{this.$router.push({name:"grn-credit-settlement"})}))},fetchRows(){(0,q.D1)(this.$route.params.GRNNO).then((e=>{this.rows=e.data,this.loading=!1})).catch((e=>{this.loading=!1}))},getResponse(e){if(e){const e={CSID:this.rows[this.selected_index].CSID,GRNNO:this.GRN.GRNNO};(0,q.LS)(e).then((e=>{(0,N.U)(e.data.message,"positive","top"),this.rows.splice(this.selected_index,1),this.selected_index=null,this.$refs.confirmbox.response=!1,this.validate_GRN()})).catch((e=>{(0,N.j)(e.response.data.message,"negative","top")}))}},Add_GRN_CS(){if(null===this.date)(0,N.j)("Date is not Selected!!");else if(Date.parse(this.date)<Date.parse(this.GRN.PurchasedDate))(0,N.j)("Date Can't be before the Purchase Date");else{const e={GRNNO:this.GRN.GRNNO,Payment:this.payment,Date:this.date,Description:this.description};(0,q.du)(e).then((e=>{(0,N.U)(e.data.message,"positive","top"),this.rows=[],this.validate_GRN()})).catch((e=>{(0,N.j)(e.response.data.message,"negative","top")}))}},reset(){this.date=null,this.description=null,this.payment=null},Update_GRN_CS(e,t){var l=this.rows[t],a=e;l[a.key]=a.value;const o={GRNNO:this.GRN.GRNNO,Payment:l.Payment,CSID:l.CSID,Date:l.Date,Description:l.Description};o.Payment<1?((0,N.j)("Payment cant be less than 1"),this.rows=[],this.fetchRows()):Date.parse(o.Date)<Date.parse(this.GRN.PurchasedDate)?((0,N.j)("Date Can't be before the Purchase Date"),this.rows=[],this.fetchRows()):(0,q.YF)(o).then((e=>((0,N.U)(e.data.message,"positive","top"),this.rows=[],this.validate_GRN(),!0))).catch((e=>((0,N.j)(e.response.data.message,"negative","top"),this.rows=[],this.fetchRows(),!1)))},show_dialog_box(e){this.$refs.confirmbox.message="The Selected Credit Settlement ",this.$refs.confirmbox.confirm=!0,this.selected_index=e},wrapCsvValue(e,t){let l=void 0!==t?t(e):e;return l=void 0===l||null===l?"":String(l),l=l.split('"').join('""'),`"${l}"`},exportTable(){const e=[this.columns.map((e=>this.wrapCsvValue(e.label)))].concat(this.rows.map((e=>this.columns.map((t=>this.wrapCsvValue("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format))).join(",")))).join("\r\n"),t=(0,D.Z)("table-export.csv",e,"text/csv");!0!==t&&(0,N.j)("Browser denied file download...")}},mounted(){this.validate_GRN()}};var C=l(3414),U=l(5269),G=l(4842),k=l(4554),W=l(3944),P=l(2651),S=l(2165),Z=l(3243),Q=l(1598),j=l(8870),O=l(2025),T=l(8886),$=l(8516),z=l(8186),K=l(3884),Y=l(1289),I=l(677),B=l(7518),F=l.n(B);x.render=b;const H=x;F()(x,"components",{QItem:C.Z,QForm:U.Z,QInput:G.Z,QIcon:k.Z,QPopupProxy:W.Z,QDate:P.Z,QBtn:S.Z,QTable:Z.Z,QLinearProgress:Q.Z,QTooltip:j.Z,QSpace:O.Z,QToggle:T.Z,QSelect:$.Z,QTr:z.Z,QTd:K.Z,QPopupEdit:Y.Z}),F()(x,"directives",{ClosePopup:I.Z})}}]);