"use strict";(self["webpackChunkims"]=self["webpackChunkims"]||[]).push([[3440],{3440:(e,l,t)=>{t.r(l),t.d(l,{default:()=>W});var o=t(3673),s=t(2323),a=t(8880);const n={class:"q-pa-xl"},i={class:"q-pa-md"},r={class:"row q-gutter-md q-pa-md"},d={class:"q-pl-sm"},u={class:"col-2 q-table__title"},p={key:0,class:"col"},c={class:"row q-gutter-md"};function m(e,l,t,m,w,h){const y=(0,o.up)("SalesHeader"),f=(0,o.up)("DeleteDialogBox"),b=(0,o.up)("q-item"),v=(0,o.up)("q-space"),g=(0,o.up)("q-toggle"),_=(0,o.up)("q-select"),P=(0,o.up)("q-btn"),k=(0,o.up)("q-td"),x=(0,o.up)("q-input"),R=(0,o.up)("q-popup-edit"),V=(0,o.up)("q-tr"),Q=(0,o.up)("q-table");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",n,[(0,o.Wm)(y)]),(0,o._)("div",i,[(0,o.Wm)(f,{onResponse:h.getResponse,ref:"confirmbox"},null,8,["onResponse"]),(0,o._)("div",r,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(w.REF,((e,l)=>((0,o.wg)(),(0,o.j4)(b,{key:l},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(l)+": ",1),(0,o._)("span",d,[(0,o._)("b",null,(0,s.zw)(e),1)])])),_:2},1024)))),128))]),(0,o.Wm)(Q,{title:w.title,rows:w.rows,columns:w.columns,"row-key":"name","visible-columns":w.visibleColumns,loading:w.loading,color:"secondary","no-data-label":"There is No Date Under this Reference","rows-per-page-options":[]},{top:(0,o.w5)((t=>[(0,o._)("div",u,(0,s.zw)(w.title),1),(0,o.Wm)(v),e.$q.screen.gt.xs?((0,o.wg)(),(0,o.iD)("div",p,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.toogle_columns,(e=>((0,o.wg)(),(0,o.j4)(b,{style:{display:"inline"},key:e},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{modelValue:w.visibleColumns,"onUpdate:modelValue":l[0]||(l[0]=e=>w.visibleColumns=e),val:e.name,label:e.label,color:"secondary"},null,8,["modelValue","val","label"])])),_:2},1024)))),128))])):((0,o.wg)(),(0,o.j4)(_,{key:1,color:"secondary",modelValue:w.visibleColumns,"onUpdate:modelValue":l[1]||(l[1]=e=>w.visibleColumns=e),multiple:"",borderless:"",dense:"","options-dense":"","display-value":e.$q.lang.table.columns,"emit-value":"","map-options":"",options:w.columns,"option-value":"name",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])),(0,o.Wm)(P,{color:"secondary","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:h.exportTable},null,8,["onClick"]),(0,o.Wm)(P,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])])),body:(0,o.w5)((e=>[(0,o.Wm)(V,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{key:"SalesId",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.SalesId),1)])),_:2},1032,["props"]),(0,o.Wm)(k,{key:"ItemType",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.ItemType),1)])),_:2},1032,["props"]),(0,o.Wm)(k,{key:"PPP",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.PPP)+" ",1),(0,o.Wm)(R,{modelValue:e.row.PPP,"onUpdate:modelValue":l=>e.row.PPP=l,title:"Update Price",buttons:"",persistent:"",validate:l=>h.update_purchase({key:"PPP",value:l},w.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,o.w5)((e=>[(0,o.Wm)(x,{color:"secondary",type:"number",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,modelModifiers:{number:!0},dense:"",autofocus:"",onKeyup:(0,a.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,o.Wm)(k,{key:"Quantity",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.Quantity)+" ",1),(0,o.Wm)(R,{modelValue:e.row.Quantity,"onUpdate:modelValue":l=>e.row.Quantity=l,title:"Update Quantity",buttons:"",persistent:"",validate:l=>h.update_purchase({key:"Quantity",value:l},w.rows.indexOf(e.row)),"label-set":"Update",color:"secondary",class:"text-secondary"},{default:(0,o.w5)((e=>[(0,o.Wm)(x,{color:"secondary",type:"number",modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,modelModifiers:{number:!0},dense:"",autofocus:"",onKeyup:(0,a.D2)(e.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","validate"])])),_:2},1032,["props"]),(0,o.Wm)(k,{key:"Total",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.Total),1)])),_:2},1032,["props"]),(0,o.Wm)(k,{key:"action",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{color:"negative","icon-right":"delete","no-caps":"",flat:"",dense:"",onClick:l=>h.show_dialog_box(w.rows.indexOf(e.row))},null,8,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),bottom:(0,o.w5)((()=>[(0,o._)("div",c,[(0,o._)("div",null,[(0,o.Wm)(P,{to:{name:"print",params:{user:h.printable_data}},color:"secondary",icon:"print",label:"Print"},null,8,["to"])])])])),_:1},8,["title","rows","columns","visible-columns","loading"])])],64)}var w=t(2841),h=t(6966),y=t(7302),f=t(2986),b=t(7428);const v={name:"REFDetail",components:{DeleteDialogBox:h.Z,SalesHeader:y.Z},data(){return{loading:!1,title:"Purchased Items",visibleColumns:["ItemType","PPP","Quantity","Total","Remainder","Extra"],columns:[{name:"SalesId",label:"Sales ID",field:"SalesId",align:"left",sortable:!0,required:!0},{name:"ItemType",label:"Item Type",field:"ItemType",sortable:!0},{name:"PPP",label:"Price",field:"PPP",sortable:!0},{name:"Quantity",label:"Quantity",field:"Quantity",sortable:!0},{name:"Total",label:"Total",field:"Total",sortable:!0}],rows:[],selected_index:null,categories:[],REF:{}}},computed:{toogle_columns(){return this.columns.filter((e=>!0!==e.required))},printable_data(){var e={title:"Sales",table_tittle:"Sold Items",header_data:this.REF,columns:this.columns,rows:this.rows};return JSON.stringify(e)}},methods:{validate_REF(){(0,f.At)(this.$route.params.REFNO).then((e=>{this.REF=e.data,this.fetchRows()})).catch((e=>{this.$router.push({name:"sales"})}))},fetchRows(){(0,f.Jg)(this.$route.params.REFNO).then((e=>{this.rows=e.data,this.loading=!1})).catch((e=>{this.loading=!1}))},getResponse(e){if(e){const e={SalesID:this.rows[this.selected_index].SalesId,REFNO:this.rows[this.selected_index].REFNO};(0,f.cl)(e).then((e=>{(0,b.U)(e.data.message,"positive","top"),this.rows.splice(this.selected_index,1),this.selected_index=null,this.$refs.confirmbox.response=!1,this.validate_REF()})).catch((e=>{(0,b.j)(e.response.data.message,"negative","top")}))}},update_purchase(e,l){var t=this.rows[l],o=e;t[o.key]=o.value;const s={PPP:t.PPP,Quantity:t.Quantity,SalesID:t.SalesId,REFNO:t.REFNO};s.PPP<1?((0,b.j)("Price cant be less than 1"),this.rows=[],this.fetchRows()):s.Quantity<1?((0,b.j)("Quantity cant be less than 1"),this.rows=[],this.fetchRows()):(0,f.Ao)(s).then((e=>((0,b.U)(e.data.message,"positive","top"),this.rows=[],this.fetchRows(),!0))).catch((e=>((0,b.j)(e.response.data.message,"negative","top"),this.rows=[],this.fetchRows(),!1)))},show_dialog_box(e){this.$refs.confirmbox.message=`${this.rows[e].ItemType} `,this.$refs.confirmbox.confirm=!0,this.selected_index=e},wrapCsvValue(e,l){let t=void 0!==l?l(e):e;return t=void 0===t||null===t?"":String(t),t=t.split('"').join('""'),`"${t}"`},exportTable(){const e=[this.columns.map((e=>this.wrapCsvValue(e.label)))].concat(this.rows.map((e=>this.columns.map((l=>this.wrapCsvValue("function"===typeof l.field?l.field(e):e[void 0===l.field?l.name:l.field],l.format))).join(",")))).join("\r\n"),l=(0,w.Z)("table-export.csv",e,"text/csv");!0!==l&&(0,b.j)("Browser denied file download...")}},mounted(){this.validate_REF()}};var g=t(3414),_=t(3243),P=t(2025),k=t(8886),x=t(8516),R=t(2165),V=t(8186),Q=t(3884),U=t(1289),q=t(4842),I=t(7518),T=t.n(I);v.render=m;const W=v;T()(v,"components",{QItem:g.Z,QTable:_.Z,QSpace:P.Z,QToggle:k.Z,QSelect:x.Z,QBtn:R.Z,QTr:V.Z,QTd:Q.Z,QPopupEdit:U.Z,QInput:q.Z})}}]);